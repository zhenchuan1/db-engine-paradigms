# Database Engines: Vectorization vs. Compilation
This repository contains a collection of experiments, conducted to carve out the differences between two types of query processing engines: Vectorizing (interpretation based) engines and compiling engines.

## Where to Start
Have a look at src/benchmarks/tpch/queries/ to see how query processing for Typer and Tectorwise works. 

## How to Build
A configuration file is provided to build this project with CMake. 
In the project directory run:
```
mkdir -p build/release
cd build/release
cmake -DCMAKE_BUILD_TYPE=Release ../..
make
```

This creates among others the main binaries test\_all and run\_tpch.
Use test\_all to run unit tests and check whether your compilation worked.
Our main binary run\_tpch requires TPC-H tables as generated by the TPC-H dbgen tool. With these our experimental queries can be run on arbitrary scale factors.

## Build and Run On Docker
```asm
docker pull zhenchuan1/db
docker run --privileged --rm -it zhenchuan1:db /bin/bash
scl enable devtoolset-7 bash
cd ~/db-engine-paradigms/build/release
./run_ssb 1 /root/ssb-dbgen/ 1
```
## Build and Run On Mac
```asm
cd oneTBB-2018_U6
make all
export PATH=db-engine-paradigms/oneTBB-2018_U6/build/linux_intel64_gcc_cc7_libc2.17_kernel5.10.104_release:$PATH
cd ../
mkdir -p build/release
cd build/release
cmake -DCMAKE_BUILD_TYPE=Release -DTBB_INCLUDE_DIRS=db-engine-paradigms/oneTBB-2018_U6/include -DTBB_LIBRARIES="tbb tbbmalloc tbbmalloc_proxy" ../..
make
cd ../../ssb-dbgen
make
./dbgen -T c
./dbgen -T p
./dbgen -T s
./dbgen -T d
./dbgen -T l
cd ../build/release
./run_ssb 1 db-engine-paradigms/ssb-dbgen/ 1
```
if you build ssb-dbgen failed, you can copy the ```*.tbl``` from ``/root/ssb-dbgen`` in docker to your mac ``db-engine-paradigms/ssb-dbgen/`` dir

## reference
- [tbb official site](https://www.intel.com/content/www/us/en/developer/articles/release-notes/intel-threading-building-blocks-release-notes.html)
- [install high version gcc on centos](https://linuxize.com/post/how-to-install-gcc-compiler-on-centos-7/)
- [linux chown command](http://c.biancheng.net/view/761.html)
- [why can we run perf in docker or vm](https://www.swift.org/server/guides/linux-perf.html)
- [use perf in vm](https://www.cnblogs.com/azureology/p/13913540.html)
- [run perf in docker](https://chinggg.github.io/post/docker-perf/)

## TODO
- [ ] ``make`` in ssb-dbgen on mac compiled failed
- [ ] run perf tools in docker and collect all events.
